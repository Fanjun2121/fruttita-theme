<!--
  Fruttita Custom Section: Dual-Column Comparison
  Coconut Water vs Fruttita Shot — 5 metric rows + conclusion
-->

<style>
  .fruttita-comparison-{{ section.id }} {
    background-color: {{ section.settings.bg_color }};
    color: {{ section.settings.text_color }};
    padding: 6rem 1.5rem;
    font-family: 'Switzer', sans-serif;
    position: relative;
    overflow: hidden;
  }

  .fruttita-comparison-{{ section.id }}::before {
    content: '';
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
  }

  .comp-inner-{{ section.id }} {
    position: relative;
    z-index: 1;
    max-width: 800px;
    margin: 0 auto;
  }

  .comp-header-{{ section.id }} {
    text-align: center;
    margin-bottom: 3.5rem;
  }

  .comp-subtitle-{{ section.id }} {
    font-family: 'Pacifico', cursive;
    color: #C6812B;
    font-size: 1.3rem;
    display: block;
    margin-bottom: 0.5rem;
  }

  .comp-title-{{ section.id }} {
    font-size: 2rem;
    font-weight: 800;
    line-height: 1.3;
    letter-spacing: 0.02em;
  }

  /* Table header */
  .comp-table-head-{{ section.id }} {
    display: grid;
    grid-template-columns: 1.2fr 1fr 1fr;
    gap: 1rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid rgba(244, 227, 201, 0.15);
    margin-bottom: 0.5rem;
  }

  .comp-col-label-{{ section.id }} {
    font-size: 0.8rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    opacity: 0.5;
    text-align: center;
  }

  .comp-col-label-{{ section.id }}:first-child {
    text-align: left;
  }

  .comp-col-name-{{ section.id }} {
    font-size: 1rem;
    font-weight: 800;
    text-align: center;
  }

  .comp-col-name-{{ section.id }}.is-winner {
    color: #78AA00;
  }

  /* Metric rows */
  .comp-row-{{ section.id }} {
    display: grid;
    grid-template-columns: 1.2fr 1fr 1fr;
    gap: 1rem;
    padding: 1.2rem 0;
    border-bottom: 1px solid rgba(244, 227, 201, 0.08);
    align-items: center;
    opacity: 0;
    transform: translateY(15px);
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  .comp-row-{{ section.id }}.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .comp-metric-label-{{ section.id }} {
    font-size: 0.95rem;
    font-weight: 600;
  }

  .comp-cell-{{ section.id }} {
    text-align: center;
    font-size: 0.95rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }

  .comp-status-bad-{{ section.id }} {
    color: #EF4444;
    opacity: 0.8;
  }

  .comp-status-good-{{ section.id }} {
    color: #78AA00;
    font-weight: 800;
  }

  .comp-status-icon-{{ section.id }} {
    width: 18px;
    height: 18px;
    flex-shrink: 0;
  }

  /* Conclusion */
  .comp-conclusion-{{ section.id }} {
    margin-top: 2.5rem;
    padding: 1.5rem 2rem;
    background: rgba(120, 170, 0, 0.1);
    border: 1px solid rgba(120, 170, 0, 0.2);
    border-radius: 1rem;
    text-align: center;
    font-size: 1rem;
    line-height: 1.7;
    opacity: 0;
    transform: translateY(15px);
    transition: opacity 0.6s ease, transform 0.6s ease;
  }

  .comp-conclusion-{{ section.id }}.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .comp-source-{{ section.id }} {
    margin-top: 2rem;
    text-align: center;
    font-size: 0.8rem;
    opacity: 0.35;
    letter-spacing: 0.03em;
  }

  @media (max-width: 768px) {
    .fruttita-comparison-{{ section.id }} {
      padding: 4rem 1rem;
    }

    .comp-title-{{ section.id }} {
      font-size: 1.6rem;
    }

    .comp-table-head-{{ section.id }},
    .comp-row-{{ section.id }} {
      grid-template-columns: 1fr 0.8fr 0.8fr;
      gap: 0.5rem;
    }

    .comp-metric-label-{{ section.id }},
    .comp-cell-{{ section.id }} {
      font-size: 0.85rem;
    }

    .comp-col-name-{{ section.id }} {
      font-size: 0.85rem;
    }
  }
</style>

<div class="fruttita-comparison-{{ section.id }}">
  <div class="comp-inner-{{ section.id }}">
    <div class="comp-header-{{ section.id }}">
      {% if section.settings.subtitle != blank %}
        <span class="comp-subtitle-{{ section.id }}">{{ section.settings.subtitle }}</span>
      {% endif %}
      <h2 class="comp-title-{{ section.id }}">{{ section.settings.title }}</h2>
    </div>

    <!-- Table header -->
    <div class="comp-table-head-{{ section.id }}">
      <div class="comp-col-label-{{ section.id }}">指标</div>
      <div class="comp-col-name-{{ section.id }}">主流椰子水</div>
      <div class="comp-col-name-{{ section.id }} is-winner">Fruttita Shot</div>
    </div>

    <!-- Metric rows from blocks -->
    <div id="compRows-{{ section.id }}">
      {% for block in section.blocks %}
        <div class="comp-row-{{ section.id }}" {{ block.shopify_attributes }} style="transition-delay: {{ forloop.index0 | times: 100 }}ms;">
          <div class="comp-metric-label-{{ section.id }}">{{ block.settings.label }}</div>
          <div class="comp-cell-{{ section.id }} comp-status-{{ block.settings.comp_status }}-{{ section.id }}">
            {% if block.settings.comp_status == 'bad' %}
              <svg class="comp-status-icon-{{ section.id }}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            {% else %}
              <svg class="comp-status-icon-{{ section.id }}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
            {% endif %}
            {{ block.settings.comp_value }}
          </div>
          <div class="comp-cell-{{ section.id }} comp-status-{{ block.settings.fruttita_status }}-{{ section.id }}">
            {% if block.settings.fruttita_status == 'good' %}
              <svg class="comp-status-icon-{{ section.id }}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
            {% else %}
              <svg class="comp-status-icon-{{ section.id }}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            {% endif %}
            {{ block.settings.fruttita_value }}
          </div>
        </div>
      {% endfor %}
    </div>

    {% if section.settings.conclusion != blank %}
      <div class="comp-conclusion-{{ section.id }}" id="compConclusion-{{ section.id }}">
        {{ section.settings.conclusion }}
      </div>
    {% endif %}

    {% if section.settings.source_note != blank %}
      <div class="comp-source-{{ section.id }}">{{ section.settings.source_note }}</div>
    {% endif %}
  </div>
</div>

<script>
  (function() {
    var rows = document.querySelectorAll('#compRows-{{ section.id }} .comp-row-{{ section.id }}');
    var conclusion = document.getElementById('compConclusion-{{ section.id }}');
    var observer = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.15 });
    rows.forEach(function(row) { observer.observe(row); });
    if (conclusion) observer.observe(conclusion);
  })();
</script>

{% schema %}
{
  "name": "Fruttita Comparison",
  "settings": [
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle (Pacifico)",
      "default": "The Truth"
    },
    {
      "type": "textarea",
      "id": "title",
      "label": "Title",
      "default": "都说椰子水消肿，但你看过它的钠含量吗？"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#4F2C1D"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#F4E3C9"
    },
    {
      "type": "textarea",
      "id": "conclusion",
      "label": "Conclusion",
      "default": "同样是「消肿神器」，一个高钠锁水，一个零钠排水。选哪个，身体会告诉你。"
    },
    {
      "type": "text",
      "id": "source_note",
      "label": "Source Note",
      "default": "数据来源：SGS / Eurofins 第三方检测报告，主流椰子水取市售Top3品牌均值"
    }
  ],
  "blocks": [
    {
      "type": "metric",
      "name": "Comparison Row",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Metric Label",
          "default": "钠含量"
        },
        {
          "type": "text",
          "id": "comp_value",
          "label": "Competitor Value",
          "default": "105mg"
        },
        {
          "type": "select",
          "id": "comp_status",
          "label": "Competitor Status",
          "default": "bad",
          "options": [
            { "value": "bad", "label": "Bad (red)" },
            { "value": "good", "label": "Good (green)" }
          ]
        },
        {
          "type": "text",
          "id": "fruttita_value",
          "label": "Fruttita Value",
          "default": "0mg"
        },
        {
          "type": "select",
          "id": "fruttita_status",
          "label": "Fruttita Status",
          "default": "good",
          "options": [
            { "value": "bad", "label": "Bad (red)" },
            { "value": "good", "label": "Good (green)" }
          ]
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Fruttita Comparison",
      "blocks": [
        {
          "type": "metric",
          "settings": {
            "label": "钠含量",
            "comp_value": "105mg",
            "comp_status": "bad",
            "fruttita_value": "0mg",
            "fruttita_status": "good"
          }
        },
        {
          "type": "metric",
          "settings": {
            "label": "钾含量",
            "comp_value": "250mg",
            "comp_status": "good",
            "fruttita_value": "380mg+",
            "fruttita_status": "good"
          }
        },
        {
          "type": "metric",
          "settings": {
            "label": "天然维C",
            "comp_value": "2.4mg",
            "comp_status": "bad",
            "fruttita_value": "420mg+",
            "fruttita_status": "good"
          }
        },
        {
          "type": "metric",
          "settings": {
            "label": "膳食纤维",
            "comp_value": "0g",
            "comp_status": "bad",
            "fruttita_value": "10g+",
            "fruttita_status": "good"
          }
        },
        {
          "type": "metric",
          "settings": {
            "label": "添加剂",
            "comp_value": "有（风味/酸度调节）",
            "comp_status": "bad",
            "fruttita_value": "无（纯原浆）",
            "fruttita_status": "good"
          }
        }
      ]
    }
  ]
}
{% endschema %}
